/*
 Copyright 2011, Cardinal Path and Direct Performance.

 GAS - Google Analytics on Steroids
 https://bitbucket.org/dpc/gas

 @author Eduardo Cereto <eduardocereto@gmail.com>
 $Revision$
 $Date$
 Licensed under the MIT license.
*/
(function(h,n){function p(){this.tracker=h._gat._getTrackers()[0]}function r(){var a=this;a.b={};a.h=0;a.l=z;a.f="_gas1";a.i={};a.d={_addHook:[a.m]};a.push(function(){a.i=new p})}function q(a){if(_gas.o)try{console.log(a)}catch(b){}return h._gaq.push(a)}function I(a,b){if(typeof a!=="string")return!1;var d=a.split("?")[0],d=d.split(".");return(d=d[d.length-1])&&this.g(b,d)?d:!1}function J(a){for(var b=this,d=f.getElementsByTagName("a"),c=0;c<d.length;c++)this.a(d[c],"mousedown",function(c){if(c.target&&
c.target.tagName==="A"){var d=I.call(b,c.target.href,a);d&&_gas.push(["_trackEvent","Download",d,c.target.href])}})}function K(a,b){function d(b){var c=b.target,c=c.name||c.id||c.type||c.nodeName,b=b.type,d=a.name||a.id||n;_gas.push(["_trackEvent","Form Tracking","form"+(d?" ("+d+")":""),c+" ("+b+")"])}var c=this;if(b)c.a(h,"click",function(a){try{var b=a.target;a.type=="click"&&c.g(["button","submit","image","reset"],b.type.toLowerCase())&&d(a)}catch(g){}}),c.a(f.body,"change",function(a){try{var b=
a.target;a.type=="change"&&c.g(["input","select","textarea","hidden"],b.nodeName.toLowerCase())&&d(a)}catch(g){}});else{var e,g;if(!a.elements||!a.elements.length)return!1;for(e=0;e<a.elements.length;e++)g=a.elements[e],c.g(["button","submit","image","reset"],g.type)?c.a(g,"click",d):c.a(g,"change",d);c.a(a,"submit",d)}}function v(a){_gas.push(["_trackEvent",this.tagName,a.type,this.currentSrc])}function A(a){var b=this;b.e(function(){for(var d=f.getElementsByTagName(a),c=0;c<d.length;c++)b.a(d[c],
"play",v),b.a(d[c],"ended",v),b.a(d[c],"pause",v)})}function B(){return Math.max(f.body.scrollHeight||0,o.scrollHeight||0,f.body.offsetHeight||0,o.offsetHeight||0,f.body.clientHeight||0,o.clientHeight||0)}function C(a){w&&clearTimeout(w);a===!0?k=Math.max(((h.pageYOffset||f.body.scrollTop||o.scrollTop||0)+(h.innerHeight||o.clientHeight||f.body.clientHeight||0))/B()*100,k):w=setTimeout(function(){k=Math.max(((h.pageYOffset||f.body.scrollTop||o.scrollTop||0)+(h.innerHeight||o.clientHeight||f.body.clientHeight||
0))/B()*100,k)},400)}function L(){C(!0);k=Math.floor(k);if(!(k<=0||k>100)){var a=(k>10?1:0)*(Math.floor((k-1)/10)*10+1),a=String(a)+"-"+String(Math.ceil(k/10)*10);_gas.push(["_trackEvent","Max Scroll",D,a,Math.floor(k),!0])}}function s(a,b,d){if(d.contentWindow&&d.contentWindow.postMessage){var c=d.getAttribute("src").split("?")[0],a=JSON.stringify({method:a,value:b});d.contentWindow.postMessage(a,c)}}function E(a){for(var b=f.getElementsByTagName("iframe"),d=0,c,e,g,j=0;j<b.length;j++)if(i.call(b[j].src,
"//player.vimeo.com")>-1){c="gas_vimeo_"+j;e=b[j].src;g="?";i.call(e,"?")>-1&&(g="&");if(i.call(e,"api=1")<0)if(a)e+=g+"api=1&player_id="+c;else break;else i.call(e,"player_id=")<-1&&(e+=g+"player_id="+c);d++;b[j].id=c;if(b[j].src!==e){b[j].src=e;break}s("getVideoUrl","",b[j]);s("addEventListener","play",b[j]);s("addEventListener","pause",b[j]);s("addEventListener","finish",b[j])}d>0&&F===!1&&(this.a(h,"message",function(a){if(i.call(a.origin,"//player.vimeo.com")>-1)if(a=JSON.parse(a.data),a.event===
"ready")E();else if(a.method){if(a.method=="getVideoUrl")G[a.q]=a.value}else _gas.push(["_trackEvent","Vimeo Video",a.event,G[a.q]])},!1),F=!0)}function x(a,b){if(l[b]==n||l[b].j.length<=0)return!1;if(a.getCurrentTime()/a.getDuration()*100>=l[b].j[0]){var d=l[b].j.shift();_gas.push(["_trackEvent","YouTube Video",d+"%",a.getVideoUrl()])}l[b].k=setTimeout(x,1E3,a,b)}function y(a){var b=a.getVideoData().video_id;l[b]&&l[b].k&&(x(a,b),clearTimeout(l[b].k))}function M(a){var b="";switch(a.data){case 0:b=
"finish";y(a.target);break;case 1:var b="play",d=a.target;if(t&&t.length){var c=d.getVideoData().video_id;l[c]?y(d):(l[c]={},l[c].j=m.call(t));l[c].k=setTimeout(x,1E3,d,c)}break;case 2:b="pause",y(a.target)}b&&_gas.push(["_trackEvent","YouTube Video",b,a.target.getVideoUrl()])}function N(a){_gas.push(["_trackEvent","YouTube Video","error ("+a.data+")",a.target.getVideoUrl()])}function O(a,b){for(var d=[],c=f.getElementsByTagName("iframe"),e=0;e<c.length;e++)if(i.call(c[e].src,"//www.youtube.com/embed")>
-1){if(i.call(c[e].src,"enablejsapi=1")<0)if(a)c[e].src+=i.call(c[e].src,"?")<0?"?enablejsapi=1":"&enablejsapi=1";else continue;d.push(c[e])}if(d.length>0)b&&b.length&&(t=b),h.onYouTubePlayerAPIReady=function(){for(var a,b=0;b<d.length;b++)a=new h.YT.Player(d[b]),a.addEventListener("onStateChange",M),a.addEventListener("onError",N)},c=f.createElement("script"),c.src="http://www.youtube.com/player_api",c.type="text/javascript",c.async=!0,e=f.getElementsByTagName("script")[0],e.parentNode.insertBefore(c,
e)}p.prototype.g=function(a,b){if(a&&a.length)for(var d=0;d<a.length;d++)if(a[d]===b)return!0;return!1};p.prototype.isArray=function(a){return P.call(a)==="[object Array]"};p.prototype.a=function(a,b,d,c){function e(b){if(!b||!b.target)b=h.event,b.target=b.srcElement;return d.call(a,b)}a.addEventListener?a.addEventListener(b,e,!!c):a.attachEvent?a.attachEvent("on"+b,e):(b="on"+b,typeof a[b]==="function"&&(e=function(a,b){return function(){a.apply(this,arguments);b.apply(this,arguments)}}(a[b],e)),
a[b]=e)};p.prototype.e=function(a){function b(){if(!arguments.callee.p)arguments.callee.p=!0,a.apply(this,arguments)}/^(interactive|complete)/.test(f.readyState)?b():(this.a(f,"DOMContentLoaded",b,!1),this.a(h,"load",b,!1))};h._gaq=h._gaq||[];var z=h._gas||[];if(!(z.h>=0)){var f=h.document,P=Object.prototype.toString,Q=Object.prototype.hasOwnProperty,m=Array.prototype.slice,i=String.prototype.indexOf,D=f.location.href,o=f.documentElement;r.prototype.m=function(a,b){typeof a==="string"&&typeof b===
"function"&&(typeof _gas.d[a]==="undefined"&&(_gas.d[a]=[]),_gas.d[a].push(b));return!1};r.prototype.n=function(){var a=m.call(arguments),b=a.shift(),a=!0,d,c,e,g,f;if(typeof b==="function")return q(function(a,b){return function(){a.call(b)}}(b,this.i));else if(typeof b==="object"&&b.length>0){c=b.shift();i.call(c,".")>=0?(g=c.split(".")[0],c=c.split(".")[1]):g=n;if((e=this.d[c])&&e.length>0)for(d=0;d<e.length;d++)try{f=e[d].apply(this.i,b),f===!1?a=!1:f&&f.length>0&&(b=f)}catch(h){c!=="_trackException"&&
this.push(["_trackException",h])}if(a===!1)return 1;if(c==="_setAccount"){for(d in this.b)if(this.b[d]==b[0]&&g===n)return 1;g=g||"_gas"+String(this.h+1);typeof this.b._gas1=="undefined"&&i.call(g,"_gas")!=-1&&(g="_gas1");this.b[g]=b[0];this.h+=1;g=g===_gas.f?"":g+".";return q([g+c,b[0]])}if(c==="_link"||c==="_linkByPost")return a=m.call(b),a.unshift(c),q(a);if(g&&this.b[g])return f=(g===_gas.f?"":g+".")+c,a=m.call(b),a.unshift(f),q(a);e=0;for(d in this.b)Q.call(this.b,d)&&(f=(d===_gas.f?"":d+".")+
c,a=m.call(b),a.unshift(f),e+=q(a));return e?1:0}};r.prototype.push=function(){for(var a=m.call(arguments),b=0;b<a.length;b++)(function(a,b){h._gaq.push(function(){b.n.call(b,a)})})(a[b],this)};h._gas=_gas=new r;_gas.push(["_addHook","_trackException",function(a,b){_gas.push(["_trackEvent","Exception "+(a.name||"Error"),b||a.message||a,D]);return!1}]);_gas.push(["_addHook","_setDebug",function(a){_gas.o=!!a}]);_gas.push(["_addHook","_popHook",function(a){(a=_gas.d[a])&&a.pop&&a.pop();return!1}]);
_gas.push(["_addHook","_setDefaultTracker",function(a){_gas.f=a}]);_gas.push(["_addHook","_trackPageview",function(a,b){if(b&&typeof b==="string"){var d=f.title;h.r.push(function(){f.title=b},["_trackPageview",a],function(){f.title=d});return!1}return[a]}]);_gas.push(["_addHook","_trackDownloads",function(a){var b="xls,xlsx,doc,docx,ppt,pptx,pdf,txt,zip";b+=",rar,7z,exe,wma,mov,avi,wmv,mp3,csv,tsv";b=b.split(",");typeof a==="string"?b=b.concat(a.split(",")):this.isArray(a)&&(b=b.concat(a));J.call(this,
b);return!1}]);_gas.push(["_addHook","_trackEvent",function(){var a=m.call(arguments);a[3]&&(a[3]=(a[3]<0?0:Math.round(a[3]))||0);return a}]);_gas.push(["_addHook","_trackForms",function(a){var b=this;this.e(function(){for(var d=f.getElementsByTagName("form"),c=0;c<d.length;c++){try{K.call(b,d[c],a)}catch(e){}if(a)break}return!1})}]);_gas.push(["_addHook","_trackVideo",function(){A.call(this,"video")}]);_gas.push(["_addHook","_trackAudio",function(){A.call(this,"audio")}]);var w=null,k=0;_gas.push(["_addHook",
"_trackMaxScroll",function(){this.a(h,"scroll",C);this.a(h,"beforeunload",L)}]);_gas.c=!1;_gas.push(["_addHook","_setAllowAnchor",function(a){_gas.c=!!a}]);_gas.push(["_addHook","_link",function(a,b){if(b===n)b=_gas.c;return[a,b]}]);_gas.push(["_addHook","_linkByPost",function(a,b){if(b===n)b=_gas.c;return[a,b]}]);var u=[],H=n;_gas.push(["_addHook","_setDomainName",function(a){if(i.call("."+f.location.hostname,a)<0)return u.push(a),!1;H=a}]);_gas.push(["_addHook","_addExternalDomainName",function(a){u.push(a);
return!1}]);_gas.push(["_addHook","_setMultiDomain",function(a){var b=f.location.hostname,d=this,c,e,g,h=f.getElementsByTagName("a");a!=="now"&&a!=="mousedown"&&(a="click");for(c=0;c<h.length;c++)if(g=h[c],i.call(g.href,"http")===0&&!(g.hostname==b||i.call(g.hostname,H)>=0))for(e=0;e<u.length;e++)if(i.call(g.hostname,u[e])>=0)a==="now"?g.href=d.tracker._getLinkerUrl(g.href,_gas.c):a==="click"?this.a(g,a,function(a){_gas.push(["_link",this.href,_gas.c]);a.preventDefault?a.preventDefault():a.returnValue=
!1}):this.a(g,a,function(){this.href=d.tracker._getLinkerUrl(this.href,_gas.c)});return!1}]);_gas.push(["_addHook","_trackOutboundLinks",function(){for(var a=f.getElementsByTagName("a"),b=0;b<a.length;b++)this.a(a[b],"mousedown",function(a){a=a.target;if((a.protocol=="http:"||a.protocol=="https:")&&i.call(a.href,f.location.hostname)===-1){var b=a.pathname+a.search+"",e=i.call(b,"__utm");e!==-1&&(b=b.substring(0,e));_gas.push(["_trackEvent","Outbound",a.hostname,b])}})}]);var G={},F=!1;_gas.push(["_addHook",
"_trackVimeo",function(a){var b=this;b.e(function(){E.call(b,a)});return!1}]);var t=[],l={};for(_gas.push(["_addHook","_trackYoutube",function(){var a=m.call(arguments),b=this;b.e(function(){O.apply(b,a)});return!1}]);_gas.l.length>0;)_gas.push(_gas.l.shift());_gaq&&_gaq.length>=0&&function(){var a=f.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==f.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=f.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,
b)}()}})(window);
