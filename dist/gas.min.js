/*
 Copyright 2011, Cardinal Path and Direct Performance.

 GAS - Google Analytics on Steroids
 https://bitbucket.org/dpc/gas

 @author Eduardo Cereto <eduardocereto@gmail.com>
 $Revision$
 $Date$
 Licensed under the MIT license.
*/
(function(f,l){function m(){this.tracker=f._gat._getTrackerByName()}function p(){var a=this;a.b={};a.i=0;a.j=u;a.f="_gas1";a.g={};a.d={_addHook:[a.k]};a.push(function(){a.g=new m})}function n(a){if(_gas.m)try{console.log(a)}catch(b){}return f._gaq.push(a)}function F(a,b){if(typeof a!=="string")return!1;var c=a.split("?")[0],c=c.split(".");return(c=c[c.length-1])&&this.h(b,c)?c:!1}function G(a){var b=this;this.a(f,"mousedown",function(c){if(c.target&&c.target.tagName==="A"){var d=F.call(b,c.target.href,
a);d&&_gas.push(["_trackEvent","Download",d,c.target.href])}})}function H(a,b){function c(b){var c=b.target||this,c=c.name||c.id||c.type,b=b.type,d=a.name||a.id;_gas.push(["_trackEvent","Form Tracking","form"+(d?" ("+d+")":""),c+" ("+b+")"])}var d=this;if(b)d.a(f,"click",function(a){try{var b=a.target;a.type=="click"&&d.h(["button","submit","image","reset"],b.type.toLowerCase())&&c(a)}catch(g){}}),d.a(e.body,"change",function(a){try{var b=a.target;a.type=="change"&&d.h(["input","select","textarea",
"hidden"],b.tagName.toLowerCase())&&c(a)}catch(g){}});else{var j,g;if(!a.elements||!a.elements.length)return!1;for(j=0;j<a.elements.length;j++)g=a.elements[j],d.h(["button","submit","image","reset"],g.type)?d.a(g,"click",c):d.a(g,"change",c);d.a(a,"submit",c)}}function s(a){_gas.push(["_trackEvent",this.nodeName,a.type,this.currentSrc])}function v(a){for(var a=e.getElementsByTagName(a),b=0;b<a.length;b++)this.a(a[b],"play",s),this.a(a[b],"ended",s),this.a(a[b],"pause",s)}function w(){var a=0,b=0;
if(typeof f.innerWidth=="number")a=f.innerWidth,b=f.innerHeight;else if(e.documentElement&&(e.documentElement.clientWidth||e.documentElement.clientHeight))a=e.documentElement.clientWidth,b=e.documentElement.clientHeight;else if(e.body&&(e.body.clientWidth||e.body.clientHeight))a=e.body.clientWidth,b=e.body.clientHeight;return[a,b]}function x(){var a=0,b=0;if(typeof f.pageYOffset=="number")b=f.pageYOffset,a=f.pageXOffset;else if(e.body&&(e.body.scrollLeft||e.body.scrollTop))b=e.body.scrollTop,a=e.body.scrollLeft;
else if(e.documentElement&&(e.documentElement.scrollLeft||e.documentElement.scrollTop))b=e.documentElement.scrollTop,a=e.documentElement.scrollLeft;return[a,b]}function y(){var a=e;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}function z(a){t&&clearTimeout(t);a===!0?k=Math.max((x()[1]+w()[1])/y()*100,k):t=setTimeout(function(){k=Math.max((x()[1]+
w()[1])/y()*100,k)},400)}function I(){this.a(f,"beforeunload",function(){z(!0);var a=Math.floor(k/10)*10;a<100&&(a=String(a)+"-"+String(a+9));_gas.push(["_trackEvent","Max Scroll",A,String(a),Math.round(k),!0])})}function q(a,b,c){if(c.contentWindow&&c.contentWindow.postMessage){var d=c.getAttribute("src").split("?")[0],a=JSON.stringify({method:a,value:b});c.contentWindow.postMessage(a,d)}}function B(a){for(var b=e.getElementsByTagName("iframe"),c=0,d,j,g,i=0;i<b.length;i++)if(h.call(b[i].src,"//player.vimeo.com")>
-1){d="gas_vimeo_"+i;j=b[i].src;g="?";h.call(j,"?")>-1&&(g="&");if(h.call(j,"api=1")<0)if(a)j+=g+"api=1&player_id="+d;else break;else h.call(j,"player_id=")<-1&&(j+=g+"player_id="+d);c++;b[i].id=d;if(b[i].src!==j){b[i].src=j;break}q("getVideoUrl","",b[i]);q("addEventListener","play",b[i]);q("addEventListener","pause",b[i]);q("addEventListener","finish",b[i])}c>0&&C===!1&&(this.a(f,"message",function(a){if(h.call(a.origin,"//player.vimeo.com")>-1)if(a=JSON.parse(a.data),a.event==="ready")B();else if(a.method){if(a.method==
"getVideoUrl")D[a.o]=a.value}else _gas.push(["_trackEvent","Vimeo Video",a.event,D[a.o]])},!1),C=!0)}function J(a){var b="";switch(a.data){case 0:b="finish";break;case 1:b="play";break;case 2:b="pause"}b&&_gas.push(["_trackEvent","YouTube Video",b,a.target.getVideoUrl()])}function K(a){_gas.push(["_trackEvent","YouTube Video","error ("+a.data+")",a.target.getVideoUrl()])}function L(a){for(var b=[],c=e.getElementsByTagName("iframe"),d=0;d<c.length;d++)if(h.call(c[d].src,"//www.youtube.com/embed")>
-1){if(h.call(c[d].src,"enablejsapi=1")<0)if(a)c[d].src+=h.call(c[d].src,"?")<0?"?enablejsapi=1":"&enablejsapi=1";else break;b.push(c[d])}if(b.length>0)f.onYouTubePlayerAPIReady=function(){for(var a,c=0;c<b.length;c++)a=new f.YT.Player(b[c]),a.addEventListener("onStateChange",J),a.addEventListener("onError",K)},a=e.createElement("script"),a.src="http://www.youtube.com/player_api",a.type="text/javascript",a.async=!0,c=e.getElementsByTagName("script")[0],c.parentNode.insertBefore(a,c)}m.prototype.h=
function(a,b){if(a&&a.length)for(var c=0;c<a.length;c++)if(a[c]===b)return!0;return!1};m.prototype.isArray=function(a){return M.call(a)==="[object Array]"};m.prototype.a=function(a,b,c,d){function e(b){b=b||f.event;b.target=b.target||b.srcElement;return c.call(a,b)}a.addEventListener?a.addEventListener(b,e,!!d):a.attachEvent?a.attachEvent("on"+b,e):(b="on"+b,typeof a[b]==="function"&&(e=function(a,b){return function(){a.apply(this,arguments);b.apply(this,arguments)}}(a[b],e)),a[b]=e)};m.prototype.e=
function(a){function b(){if(!arguments.callee.n)arguments.callee.n=!0,a.apply(this,arguments)}/interactive|complete/.test(e.readyState)?b():(this.a(e,"DOMContentLoaded",b,!1),this.a(f,"load",b,!1))};f._gaq=f._gaq||[];var u=f._gas||[];if(!(u.i>=0)){var e=f.document,M=Object.prototype.toString,N=Object.prototype.hasOwnProperty,o=Array.prototype.slice,h=String.prototype.indexOf,A=e.location.href;p.prototype.k=function(a,b){typeof a==="string"&&typeof b==="function"&&(typeof _gas.d[a]==="undefined"&&
(_gas.d[a]=[]),_gas.d[a].push(b));return!1};p.prototype.l=function(){var a=o.call(arguments),b=a.shift(),a=!0,c,d,e,g,f;if(typeof b==="function")return n(function(a){return function(){a.call(_gas.g)}}(b));else if(typeof b==="object"&&b.length>0){d=b.shift();h.call(d,".")>=0?(g=d.split(".")[0],d=d.split(".")[1]):g=l;if((e=_gas.d[d])&&e.length>0)for(c=0;c<e.length;c++)try{f=e[c].apply(_gas.g,b),f===!1&&(a=!1),f&&f.length>0&&(b=f)}catch(k){d!=="_trackException"&&_gas.push(["_trackException",k])}if(a===
!1)return 1;if(d==="_setAccount"){for(c in _gas.b)if(_gas.b[c]==b[0]&&g===l)return 1;g=g||"_gas"+String(_gas.i+1);typeof _gas.b._gas1=="undefined"&&h.call(g,"_gas")!=-1&&(g="_gas1");_gas.b[g]=b[0];_gas.i+=1;g=g===_gas.f?"":g+".";return n([g+d,b[0]])}if(d==="_link"||d==="_linkByPost")return a=o.call(b),a.unshift(d),n(a);if(g&&_gas.b[g])return f=(g===_gas.f?"":g+".")+d,a=o.call(b),a.unshift(f),n(a);e=0;for(c in _gas.b)N.call(_gas.b,c)&&(f=(c===_gas.f?"":c+".")+d,a=o.call(b),a.unshift(f),e+=n(a));return e?
1:0}};p.prototype.push=function(){for(var a=o.call(arguments),b=0;b<a.length;b++)(function(a){f._gaq.push(function(){_gas.l.call(_gas.g,a)})})(a[b])};f._gas=_gas=new p;_gas.push(["_addHook","_trackException",function(a,b){_gas.push(["_trackEvent","Exception "+(a.name||"Error"),b||a.message||a,A]);return!1}]);_gas.push(["_addHook","_setDebug",function(a){_gas.m=!!a}]);_gas.push(["_addHook","_popHook",function(a){(a=_gas.d[a])&&a.pop&&a.pop();return!1}]);_gas.push(["_addHook","_setDefaultTracker",function(a){_gas.f=
a}]);_gas.push(["_addHook","_trackPageview",function(a,b){if(b&&typeof b==="string"){var c=e.title;f.p.push(function(){e.title=b},["_trackPageview",a],function(){e.title=c});return!1}return[a]}]);_gas.push(["_addHook","_trackDownloads",function(a){var b="xls,xlsx,doc,docx,ppt,pptx,pdf,txt,zip";b+=",rar,7z,exe,wma,mov,avi,wmv,mp3,csv,tsv";b=b.split(",");typeof a==="string"?b=b.concat(a.split(",")):this.isArray(a)&&(b=b.concat(a));G.call(this,b);return!1}]);_gas.push(["_addHook","_trackEvent",function(a,
b,c,d){d&&(d=(d<0?0:Math.round(d))||0);return[a,b,c,d]}]);_gas.push(["_addHook","_trackForms",function(a){for(var b=e.getElementsByTagName("form"),c=0;c<b.length;c++){try{H.call(this,b[c],a)}catch(d){}if(a)break}return!1}]);_gas.push(["_addHook","_trackVideo",function(){var a=this;this.e(function(){v.call(a,"video")});return!1}]);_gas.push(["_addHook","_trackAudio",function(){var a=this;a.e(function(){v.call(a,"audio")});return!1}]);var t=null,k=0;_gas.push(["_addHook","_trackMaxSrcoll",function(){this.a(f,
"scroll",z);I.call(this)}]);_gas.c=!1;_gas.push(["_addHook","_setAllowAnchor",function(a){_gas.c=a}]);_gas.push(["_addHook","_link",function(a,b){if(b===l)b=_gas.c;return[a,b]}]);_gas.push(["_addHook","_linkByPost",function(a,b){if(b===l)b=_gas.c;return[a,b]}]);var r=[],E=l;_gas.push(["_addHook","_setDomainName",function(a){if(h.call(e.location.hostname,a)<0)return r.push(a),!1;E=a}]);_gas.push(["_addHook","_addExternalDomainName",function(a){r.push(a);return!1}]);_gas.push(["_addHook","_setMultiDomain",
function(a){var b=e.location.hostname,c=this,d,f,g,i=e.getElementsByTagName("a");a!=="now"&&a!=="mousedown"&&(a="click");for(d=0;d<i.length;d++)if(g=i[d],h.call(g.href,"http")===0&&!(g.hostname==b||h.call(g.hostname,E)>=0))for(f=0;f<r.length;f++)if(h.call(g.hostname,r[f])>=0)a==="now"?g.href=c.tracker._getLinkerUrl(g.href,_gas.c):a==="click"?this.a(g,a,function(a){_gas.push(["_link",this.href,_gas.c]);a.preventDefault?a.preventDefault():a.returnValue=!1}):this.a(g,a,function(){this.href=c.tracker._getLinkerUrl(this.href,
_gas.c)});return!1}]);_gas.push(["_addHook","_trackOutboundLinks",function(){this.a(f,"mousedown",function(a){a=a.target;if(a.nodeName==="A"&&h.call(a.href,"http")==0&&h.call(a.href,e.location.host)<0){var a=a.href.substring(h.call(a.href,"//")+2),b=h.call(a,"/")>-1?h.call(a,"/"):l,c=h.call(a,"__utm")>-1?h.call(a,"__utm")-1:l;_gas.push(["_trackEvent","Outbound",a.substring(0,b),a.substring(b,c)||"",0,!0])}})}]);var D={},C=!1;_gas.push(["_addHook","_trackVimeo",function(a){var b=this;b.e(function(){B.call(b,
a)});return!1}]);for(_gas.push(["_addHook","_trackYoutube",function(a){var b=this;b.e(function(){L.call(b,a)});return!1}]);_gas.j.length>0;)_gas.push(_gas.j.shift());_gaq&&_gaq.length>=0&&function(){var a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"==e.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=e.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}()}})(window);
