/*
 Copyright 2011, Cardinal Path and Direct Performance.

 GAS - Google Analytics on Steroids
 https://bitbucket.org/dpc/gas

 @author Eduardo Cereto <eduardocereto@gmail.com>
 $Revision$
 $Date$
 Licensed under the MIT license.
*/
(function(g, k) {
  function o() {
    this.tracker = g._gat._getTrackerByName()
  }
  function p() {
    var a = this;
    a.b = {};
    a.h = 0;
    a.j = t;
    a.e = "_gas1";
    a.f = {};
    a.d = {_addHook:[a.k]};
    a.push(function() {
      a.f = new o
    })
  }
  function m(a) {
    if(_gas.n) {
      try {
        console.log(a)
      }catch(b) {
      }
    }
    return g._gaq.push(a)
  }
  function D(a, b) {
    if(typeof a !== "string") {
      return!1
    }
    var c = a.split("?")[0], c = c.split(".");
    return(c = c[c.length - 1]) && this.g(b, c) ? c : !1
  }
  function E(a) {
    var b = this;
    this.a(g, "mousedown", function(c) {
      if(c.target && c.target.tagName === "A") {
        var d = D.call(b, c.target.href, a);
        d && _gas.push(["_trackEvent", "Download", d, c.target.href])
      }
    })
  }
  function F(a, b) {
    function c(b) {
      var c = b.target || this, c = c.name || c.id || c.type, b = b.type, d = a.name || a.id;
      _gas.push(["_trackEvent", "Form Tracking", "form" + (d ? " (" + d + ")" : ""), c + " (" + b + ")"])
    }
    var d = this;
    b === k && (b = !1);
    if(b) {
      d.a(g, "click", function(a) {
        try {
          var b = a.target;
          a.type == "click" && d.g(["button", "submit", "image", "reset"], b.type.toLowerCase()) && c(a)
        }catch(f) {
        }
      }), d.a(e.body, "change", function(a) {
        try {
          var b = a.target;
          a.type == "change" && d.g(["input", "select", "textarea", "hidden"], b.nodeName.toLowerCase()) && c(a)
        }catch(f) {
        }
      })
    }else {
      var j, f;
      if(!a.elements || !a.elements.length) {
        return!1
      }
      for(j = 0;j < a.elements.length;j++) {
        f = a.elements[j], d.g(["button", "submit", "image", "reset"], f.type) ? d.a(f, "click", c) : d.a(f, "change", c)
      }
      d.a(a, "submit", c)
    }
  }
  function u() {
    var a = 0, b = 0;
    if(typeof g.innerWidth == "number") {
      a = g.innerWidth, b = g.innerHeight
    }else {
      if(e.documentElement && (e.documentElement.clientWidth || e.documentElement.clientHeight)) {
        a = e.documentElement.clientWidth, b = e.documentElement.clientHeight
      }else {
        if(e.body && (e.body.clientWidth || e.body.clientHeight)) {
          a = e.body.clientWidth, b = e.body.clientHeight
        }
      }
    }
    return[a, b]
  }
  function v() {
    var a = 0, b = 0;
    if(typeof g.pageYOffset == "number") {
      b = g.pageYOffset, a = g.pageXOffset
    }else {
      if(e.body && (e.body.scrollLeft || e.body.scrollTop)) {
        b = e.body.scrollTop, a = e.body.scrollLeft
      }else {
        if(e.documentElement && (e.documentElement.scrollLeft || e.documentElement.scrollTop)) {
          b = e.documentElement.scrollTop, a = e.documentElement.scrollLeft
        }
      }
    }
    return[a, b]
  }
  function w() {
    var a = e;
    return Math.max(Math.max(a.body.scrollHeight, a.documentElement.scrollHeight), Math.max(a.body.offsetHeight, a.documentElement.offsetHeight), Math.max(a.body.clientHeight, a.documentElement.clientHeight))
  }
  function x(a) {
    s && clearTimeout(s);
    a === !0 ? l = Math.max((v()[1] + u()[1]) / w() * 100, l) : s = setTimeout(function() {
      l = Math.max((v()[1] + u()[1]) / w() * 100, l)
    }, 400)
  }
  function G() {
    this.a(g, "beforeunload", function() {
      x(!0);
      var a = Math.floor(l / 10) * 10;
      a < 100 && (a = String(a) + "-" + String(a + 9));
      _gas.push(["_trackEvent", "Max Scroll", y, String(a), Math.round(l), !0])
    })
  }
  function H() {
    for(var a = e.links, b = 0;b < a.length;b++) {
      i.call(a[b].href, "http") == 0 && i.call(a[b].href, e.location.host) < 0 && this.a(a[b], "mousedown", function(a) {
        return function() {
          var b = a.href.substring(i.call(a.href, "//") + 2), e = i.call(b, "/") > -1 ? i.call(b, "/") : k, f = i.call(b, "__utma") > -1 ? i.call(b, "__utma") : k;
          _gaq.push(["_trackEvent", "Outbound", b.substring(0, e), b.substring(e, f) || "", 0, !0])
        }
      }(a[b]))
    }
  }
  function q(a, b, c) {
    if(c.contentWindow && c.contentWindow.postMessage) {
      var d = c.getAttribute("src").split("?")[0], a = JSON.stringify({method:a, value:b});
      c.contentWindow.postMessage(a, d)
    }
  }
  function z(a) {
    for(var b = e.getElementsByTagName("iframe"), c = 0, d, j, f, h = 0;h < b.length;h++) {
      if(i.call(b[h].src, "//player.vimeo.com") > -1) {
        d = "gas_vimeo_" + h;
        j = b[h].src;
        f = "?";
        i.call(j, "?") > -1 && (f = "&");
        if(i.call(j, "api=1") < 0) {
          if(a) {
            j += f + "api=1&player_id=" + d
          }else {
            break
          }
        }else {
          i.call(j, "player_id=") < -1 && (j += f + "player_id=" + d)
        }
        c++;
        b[h].id = d;
        if(b[h].src !== j) {
          b[h].src = j;
          break
        }
        q("getVideoUrl", "", b[h]);
        q("addEventListener", "play", b[h]);
        q("addEventListener", "pause", b[h]);
        q("addEventListener", "finish", b[h])
      }
    }
    c > 0 && A === !1 && (this.a(g, "message", function(a) {
      if(i.call(a.origin, "//player.vimeo.com") > -1) {
        if(a = JSON.parse(a.data), a.event === "ready") {
          z()
        }else {
          if(a.method) {
            if(a.method == "getVideoUrl") {
              B[a.o] = a.value
            }
          }else {
            _gas.push(["_trackEvent", "Vimeo Video", a.event, B[a.o]])
          }
        }
      }
    }, !1), A = !0)
  }
  function I(a) {
    var b = "";
    switch(a.data) {
      case YT.i.p:
        b = "finish";
        break;
      case YT.i.r:
        b = "play";
        break;
      case YT.i.q:
        b = "pause"
    }
    b && _gas.push(["_trackEvent", "YouTube Video", b, a.target.t()])
  }
  function J(a) {
    _gas.push(["_trackEvent", "YouTube Video", "error", a.data])
  }
  function K(a) {
    for(var b = [], c = e.getElementsByTagName("iframe"), d = 0;d < c.length;d++) {
      if(i.call(c[d].src, "//www.youtube.com/embed") > -1) {
        if(i.call(c[d].src, "enablejsapi=1") < 0) {
          if(a) {
            c[d].src += i.call(c[d].src, "?") < 0 ? "?enablejsapi=1" : "&enablejsapi=1"
          }else {
            break
          }
        }
        b.push(c[d])
      }
    }
    if(b.length > 0) {
      g.u = function() {
        for(var a, c = 0;c < b.length;c++) {
          a = new YT.s(b[c]), a.addEventListener("onStateChange", I), a.addEventListener("onError", J)
        }
      }, a = e.createElement("script"), a.src = "http://www.youtube.com/player_api", a.type = "text/javascript", a.async = !0, c = e.getElementsByTagName("script")[0], c.parentNode.insertBefore(a, c)
    }
  }
  o.prototype.g = function(a, b) {
    if(a && a.length) {
      for(var c = 0;c < a.length;c++) {
        if(a[c] === b) {
          return!0
        }
      }
    }
    return!1
  };
  o.prototype.isArray = function(a) {
    return L.call(a) === "[object Array]"
  };
  o.prototype.a = function(a, b, c, d) {
    function e(b) {
      b = b || g.event;
      return c.call(a, b)
    }
    d === k && (d = !1);
    a.addEventListener ? a.addEventListener(b, e, !!d) : a.attachEvent ? a.attachEvent("on" + b, e) : (b = "on" + b, typeof a[b] === "function" && (e = function(a, b) {
      return function() {
        a.apply(this, arguments);
        b.apply(this, arguments)
      }
    }(a[b], e)), a[b] = e)
  };
  g._gaq = g._gaq || [];
  var t = g._gas || [];
  if(!(t.h >= 0)) {
    var e = g.document, L = Object.prototype.toString, M = Object.prototype.hasOwnProperty, n = Array.prototype.slice, i = String.prototype.indexOf, y = e.location.href;
    p.prototype.k = function(a, b) {
      typeof a === "string" && typeof b === "function" && (typeof _gas.d[a] === "undefined" && (_gas.d[a] = []), _gas.d[a].push(b));
      return!1
    };
    p.prototype.l = function() {
      var a = n.call(arguments), b = a.shift(), a = !0, c, d, e, f, h;
      if(typeof b === "function") {
        return m(function(a) {
          return function() {
            a.call(_gas.f)
          }
        }(b))
      }else {
        if(typeof b === "object" && b.length > 0) {
          d = b.shift();
          i.call(d, ".") >= 0 ? (f = d.split(".")[0], d = d.split(".")[1]) : f = k;
          if((e = _gas.d[d]) && e.length > 0) {
            for(c = 0;c < e.length;c++) {
              try {
                h = e[c].apply(_gas.f, b), h === !1 && (a = !1), h && h.length > 0 && (b = h)
              }catch(g) {
                d !== "_trackException" && _gas.push(["_trackException", g])
              }
            }
          }
          if(a === !1) {
            return 1
          }
          if(d === "_setAccount") {
            for(c in _gas.b) {
              if(_gas.b[c] == b[0] && f === k) {
                return 1
              }
            }
            f = f || "_gas" + String(_gas.h + 1);
            typeof _gas.b._gas1 == "undefined" && i.call(f, "_gas") != -1 && (f = "_gas1");
            _gas.b[f] = b[0];
            _gas.h += 1;
            f = f === _gas.e ? "" : f + ".";
            return m([f + d, b[0]])
          }
          if(d === "_link" || d === "_linkByPost") {
            return a = n.call(b), a.unshift(d), m(a)
          }
          if(f && _gas.b[f]) {
            return h = (f === _gas.e ? "" : f + ".") + d, a = n.call(b), a.unshift(h), m(a)
          }
          e = 0;
          for(c in _gas.b) {
            M.call(_gas.b, c) && (h = (c === _gas.e ? "" : c + ".") + d, a = n.call(b), a.unshift(h), e += m(a))
          }
          return e ? 1 : 0
        }
      }
    };
    p.prototype.push = function() {
      for(var a = n.call(arguments), b = 0;b < a.length;b++) {
        (function(a) {
          g._gaq.push(function() {
            _gas.l.call(_gas.f, a)
          })
        })(a[b])
      }
    };
    g._gas = _gas = new p;
    _gas.push(["_addHook", "_trackException", function(a, b) {
      _gas.push(["_trackEvent", "Exception " + (a.name || "Error"), b || a.message || a, y]);
      return!1
    }]);
    _gas.push(["_addHook", "_setDebug", function(a) {
      _gas.n = !!a
    }]);
    _gas.push(["_addHook", "_popHook", function(a) {
      (a = _gas.d[a]) && a.pop && a.pop();
      return!1
    }]);
    _gas.push(["_addHook", "_setDefaultTracker", function(a) {
      _gas.e = a
    }]);
    _gas.push(["_addHook", "_trackPageview", function(a, b) {
      if(b && typeof b === "string") {
        var c = e.title;
        g.m.push(function() {
          e.title = b
        }, ["_trackPageview", a], function() {
          e.title = c
        });
        return!1
      }
      return[a]
    }]);
    _gas.push(["_addHook", "_trackDownload", function(a) {
      var b = "xls,xlsx,doc,docx,ppt,pptx,pdf,txt,zip";
      b += ",rar,7z,exe,wma,mov,avi,wmv,mp3";
      b = b.split(",");
      typeof a === "string" ? b = b.concat(a.split(",")) : this.isArray(a) && (b = b.concat(a));
      E.call(this, b);
      return!1
    }]);
    _gas.push(["_addHook", "_trackEvent", function(a, b, c, d) {
      d && (d = (d < 0 ? 0 : Math.round(d)) || 0);
      return[a, b, c, d]
    }]);
    _gas.push(["_addHook", "_trackForms", function(a) {
      for(var b = 0;b < e.forms.length;b++) {
        try {
          F.call(this, e.forms[b], a)
        }catch(c) {
        }
        if(a) {
          break
        }
      }
      return!1
    }]);
    var s = null, l = 0;
    _gas.push(["_addHook", "_trackMaxSrcoll", function() {
      this.a(g, "scroll", x);
      G.call(this)
    }]);
    _gas.c = !1;
    _gas.push(["_addHook", "_setAllowAnchor", function(a) {
      _gas.c = a
    }]);
    _gas.push(["_addHook", "_link", function(a, b) {
      if(b === k) {
        b = _gas.c
      }
      return[a, b]
    }]);
    _gas.push(["_addHook", "_linkByPost", function(a, b) {
      if(b === k) {
        b = _gas.c
      }
      return[a, b]
    }]);
    var r = [], C = k;
    _gas.push(["_addHook", "_setDomainName", function(a) {
      if(i.call(e.location.hostname, a) < 0) {
        return r.push(a), !1
      }
      C = a
    }]);
    _gas.push(["_addHook", "_addExternalDomainName", function(a) {
      r.push(a);
      return!1
    }]);
    _gas.push(["_addHook", "_setMultiDomain", function(a) {
      var b = e.location.hostname, c = this, d, g, f;
      a !== "now" && a !== "mousedown" && (a = "click");
      for(d = 0;d < e.links.length;d++) {
        if(f = e.links[d], i.call(f.href, "http") == 0 && !(f.hostname == b || i.call(f.hostname, C) >= 0)) {
          for(g = 0;g < r.length;g++) {
            if(i.call(f.hostname, r[g]) >= 0) {
              a === "now" ? f.href = c.tracker._getLinkerUrl(f.href, _gas.c) : a === "click" ? this.a(f, a, function(a) {
                _gas.push(["_link", this.href, _gas.c]);
                a.preventDefault ? a.preventDefault() : a.returnValue = !1
              }) : this.a(f, a, function() {
                this.href = c.tracker._getLinkerUrl(this.href, _gas.c)
              })
            }
          }
        }
      }
      return!1
    }]);
    _gas.push(["_addHook", "_trackOutboundLinks", function() {
      H.call(this)
    }]);
    var B = {}, A = !1;
    _gas.push(["_addHook", "_trackVimeo", function(a) {
      z.call(this, a);
      return!1
    }]);
    for(_gas.push(["_addHook", "_trackYoutube", function(a) {
      K.call(this, a);
      return!1
    }]);_gas.j.length > 0;) {
      _gas.push(g.m.j.shift())
    }
    _gaq && _gaq.length >= 0 && function() {
      var a = e.createElement("script");
      a.type = "text/javascript";
      a.async = !0;
      a.src = ("https:" == e.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
      var b = e.getElementsByTagName("script")[0];
      b.parentNode.insertBefore(a, b)
    }()
  }
})(window);

